// components/DomainBasedContent.jsx
import React, { useState, useEffect } from 'react';

const DomainBasedContent = () => {
  const [resolvedDomain, setResolvedDomain] = useState(null);
  const [isLoading, setIsLoading] = useState(true);

  useEffect(() => {
    const detectDomain = async () => {
      try {
        // Try to fetch from the main URL and see where it redirects
        const response = await fetch('/api/detect-domain', {
          method: 'HEAD',
          redirect: 'follow',
          mode: 'cors',
          credentials: 'omit'
        });
        
        // Get the final URL after redirects
        const finalUrl = response.url;
        
        // Extract domain
        const urlObj = new URL(finalUrl);
        const domain = urlObj.hostname;
        
        setResolvedDomain(domain);
      } catch (error) {
        console.error('Error detecting domain:', error);
        // Fallback to current window location
        setResolvedDomain(window.location.hostname);
      } finally {
        setIsLoading(false);
      }
    };

    detectDomain();
  }, []);

  if (isLoading) {
    return <div>Detecting domain...</div>;
  }

  // Determine which domain we're on
  const isDomainA = resolvedDomain.includes('.a.com');
  const isDomainB = resolvedDomain.includes('.b.com');

  return (
    <div className="domain-content">
      {isDomainA && (
        <div className="domain-a-content">
          <h1>Welcome to Site A</h1>
          <p>This is the content for xyz.a.com</p>
          <button className="btn-a">Action for A</button>
        </div>
      )}
      
      {isDomainB && (
        <div className="domain-b-content">
          <h1>Welcome to Site B</h1>
          <p>This is the content for xyz.b.com</p>
          <button className="btn-b">Action for B</button>
        </div>
      )}
      
      {!isDomainA && !isDomainB && (
        <div className="unknown-domain">
          <p>Unknown domain: {resolvedDomain}</p>
        </div>
      )}
    </div>
  );
};

export default DomainBasedContent;
